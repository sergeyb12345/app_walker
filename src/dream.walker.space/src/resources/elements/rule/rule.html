<template>
    <div class="c_rule" if.bind="rule.name">

        <div class="c_rule-header" click.delegate="rule.expanded = !!!rule.expanded">
            <span>${rule.name}</span>
            <a class="chevron">
                <span if.bind="rule.expanded === true" class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>
                <span if.bind="rule.expanded !== true" class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>
            </a>
            <!--<div class="btn-group">
            <button type="button" click.delegate="showDetails()" class="btn btn-default">${rule.viewMode === true ? 'Hide' : 'Show'}</button>
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="caret"></span>
                <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
                <li if.bind="rule.viewMode !== true"><a click.delegate="showDetails()">Show Details</a></li>
                <li if.bind="rule.editMode !== true"><a click.delegate="startEdit()">Edit Rule</a></li>
                <li if.bind="rule.deleteMode !== true"><a click.delegate="tryDelete()">Delete Rule</a></li>
            </ul>
        </div>-->
        </div>

        <div class="c_rule-details" if.bind="rule.expanded === true">
            <form submit.delegate="applyChanges()">
                <fieldset disabled.bind="rule.editMode !== true">

                    <div class="form-group">
                        <label for="txtName">Rule Name</label>
                        <input type="text" class="form-control" id="txtName" value.bind="rule.name">
                    </div>

                    <div class="form-group">
                        <label for="txtDescription">Description</label>
                        <textarea rows="4" class="form-control" id="txtDescription" value.bind="rule.description"></textarea>
                    </div>

                    <div class="form-inline">
                        <div class="form-group">
                            <label for="ddlPeriod">Period:</label>
                            <select id="ddlPeriod" class="form-control" value.bind="rule.period">
                                <option repeat.for="period of periods" model.bind="period.id">${period.name}</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ddlCondition">Compare operator:</label>
                            <select id="ddlCondition" class="form-control" value.bind="rule.condition">
                                <option repeat.for="compareType of compareTypes" model.bind="compareType.id">${compareType.name}</option>
                            </select>
                        </div>
                    </div>

                    <!--Compare What-->
                    <div class="col-md-6">
                        <h3>Compare What</h3>

                        <div class="form-group">
                            <label for="ddlDataSourceV1">Data Source:</label>
                            <select id="ddlDataSourceV1" class="form-control" value.bind="rule.dataSourceV1">
                                <option repeat.for="dataSource of dataSources" model.bind="dataSource.id">${dataSource.name}</option>
                            </select>
                        </div>
                    
                        <div class="form-group">
                            <label for="ddlDataSeriesV1">Data Series:</label>
                            <select id="ddlDataSeriesV1" class="form-control" value.bind="rule.dataSeriesV1">
                                <option repeat.for="indicatorDs of indicatorDataSeries" model.bind="indicatorDs.id">${indicatorDs.name}</option>
                            </select>
                        </div>

                        <div class="form-inline-stack">
                            <div class="form-group">
                                <label for="txtConstV1">Constant:</label>
                                <input type="text" class="form-control" id="txtConstV1" value.bind="rule.constV1">
                            </div>
                            <div class="form-group">
                                <label for="txtSkipItemsV1">Skip:</label>
                                <input type="text" class="form-control" id="txtSkipItemsV1" value.bind="rule.skipItemsV1">
                            </div>

                            <div class="form-group">
                                <label for="txtTakeItemsV1">Take:</label>
                                <input type="text" class="form-control" id="txtTakeItemsV1" value.bind="rule.skipItemsV1">
                            </div>

                            <div class="form-group">
                                <label for="ddlTransformItemsV1">Data Series:</label>
                                <select id="ddlTransformItemsV1" class="form-control" value.bind="rule.transformItemsV1">
                                    <option repeat.for="transformFunction of transformFunctions" model.bind="transformFunction.id">${transformFunction.name}</option>
                                </select>
                            </div>

                        </div>
                    </div>

                    <!--Compare With-->
                    <div class="col-md-6">
                        <h3>Compare With</h3>
                        <div class="form-group">
                            <label for="ddlDataSourceV2">Data Source:</label>
                            <select id="ddlDataSourceV2" class="form-control" value.bind="rule.dataSourceV2">
                                <option repeat.for="dataSource of dataSources" model.bind="dataSource.id">${dataSource.name}</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="ddlDataSeriesV2">Data Series:</label>
                            <select id="ddlDataSeriesV2" class="form-control" value.bind="rule.dataSeriesV2">
                                <option repeat.for="indicatorDs of indicatorDataSeries" model.bind="indicatorDs.id">${indicatorDs.name}</option>
                            </select>
                        </div>

                        <div class="form-inline-stack">
                            <div class="form-group">
                                <label for="txtConstV2">Constant:</label>
                                <input type="text" class="form-control" id="txtConstV2" value.bind="rule.constV1">
                            </div>

                            <div class="form-group">
                                <label for="txtSkipItemsV2">Skip:</label>
                                <input type="text" class="form-control" id="txtSkipItemsV2" value.bind="rule.skipItemsV1">
                            </div>

                            <div class="form-group">
                                <label for="txtTakeItemsV2">Take:</label>
                                <input type="text" class="form-control" id="txtTakeItemsV2" value.bind="rule.skipItemsV1">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="ddlTransformItemsV2">Data Series:</label>
                            <select id="ddlTransformItemsV2" class="form-control" value.bind="rule.transformItemsV2">
                                <option repeat.for="transformFunction of transformFunctions" model.bind="transformFunction.id">${transformFunction.name}</option>
                            </select>
                        </div>

                    </div>

                    <div class="form-group" if.bind="rule.editMode === true">
                        <button type="submit" class="btn btn-primary btn-xs">Apply Changes</button>
                        <button type="button" click.delegate="cancelEdit()" class="btn btn-default btn-xs">Cancel</button>
                    </div>
                </fieldset>
            </form>
        </div>

    </div>
</template>